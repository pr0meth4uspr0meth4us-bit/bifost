<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage {{ app.app_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
<nav class="bg-white border-b border-gray-200 px-6 py-4 mb-8">
    <div class="max-w-7xl mx-auto flex items-center space-x-4">
        <a href="{{ url_for('backoffice.dashboard') }}" class="text-gray-500 hover:text-gray-900">‚Üê Back</a>
        <h1 class="text-xl font-bold">{{ app.app_name }} <span class="text-gray-400 font-normal">| User Management</span></h1>
    </div>
</nav>

<div class="max-w-7xl mx-auto px-6">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="mb-6 p-4 rounded-lg
                    {% if category == 'success' %}bg-green-50 text-green-700 border-green-200
                    {% elif category == 'danger' %}bg-red-50 text-red-700 border-red-200
                    {% else %}bg-yellow-50 text-yellow-700 border-yellow-200{% endif %} border">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-8">
        <h3 class="font-bold text-gray-800 mb-4">Add New Member</h3>
        <form action="{{ url_for('backoffice.add_user_to_app', app_id=app._id) }}" method="POST" class="flex flex-col md:flex-row gap-4">
            <input type="email" name="email" placeholder="User Email Address (must exist in Bifrost)" class="flex-1 p-2 border border-gray-300 rounded outline-none focus:border-indigo-500" required>
            <select name="role" class="p-2 border border-gray-300 rounded outline-none focus:border-indigo-500">
                <option value="user">Regular User</option>
                <option value="premium_user">Premium User</option>
                <option value="admin">App Admin</option>
            </select>
            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded transition">
                + Add User
            </button>
        </form>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expires</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
            {% for user in users %}
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">{{ user.display_name }}</div>
                    <div class="text-sm text-gray-500">{{ user.email or user.telegram_id }}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                {% if user.role == 'admin' %}bg-purple-100 text-purple-800
                                {% elif user.role == 'premium_user' %}bg-green-100 text-green-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ user.role }}
                            </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ user.expires_at.strftime('%Y-%m-%d') if user.expires_at else 'Lifetime' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <form action="{{ url_for('backoffice.update_user_role', app_id=app._id, user_id=user.account_id) }}" method="POST" class="flex space-x-2">
                        <select name="role" class="text-sm border border-gray-300 rounded px-2 py-1">
                            <option value="user" {% if user.role == 'user' %}selected{% endif %}>User</option>
                            <option value="premium_user" {% if user.role == 'premium_user' %}selected{% endif %}>Premium</option>
                            <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                            <option value="banned" {% if user.role == 'banned' %}selected{% endif %}>Ban</option>
                        </select>
                        <select name="duration" class="text-sm border border-gray-300 rounded px-2 py-1">
                            <option value="">No Change</option>
                            <option value="1m">+1 Month</option>
                            <option value="1y">+1 Year</option>
                            <option value="lifetime">Lifetime</option>
                        </select>
                        <button type="submit" class="text-indigo-600 hover:text-indigo-900">Save</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</body>
</html>