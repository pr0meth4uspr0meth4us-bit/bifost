<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bifrost API Reference</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        code { font-family: 'JetBrains Mono', monospace; }
        html { scroll-behavior: smooth; }

        /* Copy Animation Classes */
        .endpoint-copy {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .endpoint-copy:hover {
            background-color: #e2e8f0; /* slate-200 */
        }
        .endpoint-copy:active {
            transform: scale(0.98);
        }
        .endpoint-copy::after {
            content: 'Click to copy';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.6rem;
            color: #64748b;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .endpoint-copy:hover::after {
            opacity: 1;
        }

        /* Payload Highlighter */
        .payload-block {
            border-left: 4px solid #6366f1; /* Indigo-500 */
        }
    </style>
</head>
<body class="bg-base-100">

<div id="toast-container" class="toast toast-end z-50"></div>

<div class="drawer lg:drawer-open">
  <input id="docs-drawer" type="checkbox" class="drawer-toggle" />

  <div class="drawer-content flex flex-col">
    <div class="w-full navbar bg-base-100 lg:hidden border-b border-base-200 sticky top-0 z-30">
      <div class="flex-none">
        <label for="docs-drawer" class="btn btn-square btn-ghost">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </label>
      </div>
      <div class="flex-1 px-2 mx-2 font-bold text-lg">Bifrost API</div>
    </div>

    <main class="p-6 lg:p-12 max-w-6xl mx-auto w-full">

        <div class="mb-16">
            <h1 class="text-4xl font-extrabold text-base-content mb-4">Integration Guide</h1>
            <p class="text-xl text-base-content/70 max-w-3xl">
                The complete reference for authentication, role management, and payment processing.
            </p>
            <div class="mt-6 flex gap-4 items-center">
                <div class="badge badge-primary badge-lg gap-2 p-4">Base URL</div>
                <code onclick="copyText('https://objective-denna-auppecampus-9a7d86fc.koyeb.app')" class="endpoint-copy font-mono bg-base-200 px-4 py-2 rounded-lg text-sm">https://objective-denna-auppecampus-9a7d86fc.koyeb.app</code>
            </div>
        </div>

        <div class="divider"></div>

        <section id="roles-hierarchy" class="mb-24 scroll-mt-24">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-3">
                <span class="bg-neutral text-neutral-content w-8 h-8 rounded-lg flex items-center justify-center text-sm">0</span>
                Role Hierarchy
            </h2>

            <div class="grid lg:grid-cols-2 gap-12">
                <div>
                    <p class="mb-6 text-base-content/80">
                        Bifrost enforces a strict permission ladder. Roles inherit permissions from the tiers below them.
                    </p>
                    <ul class="steps steps-vertical w-full">
                        <li class="step step-neutral" data-content="?">
                            <div class="text-left w-full pl-4">
                                <strong class="block">Guest</strong>
                                <span class="text-xs text-base-content/60">Unauthenticated or email unverified.</span>
                            </div>
                        </li>
                        <li class="step step-primary" data-content="‚úì">
                            <div class="text-left w-full pl-4">
                                <strong class="block">User</strong>
                                <span class="text-xs text-base-content/60">Standard authenticated user (Free Tier).</span>
                            </div>
                        </li>
                        <li class="step step-accent" data-content="‚òÖ">
                            <div class="text-left w-full pl-4">
                                <strong class="block">Premium User</strong>
                                <span class="text-xs text-base-content/60">Active subscription holder.</span>
                            </div>
                        </li>
                        <li class="step step-accent" data-content="+">
                            <div class="text-left w-full pl-4">
                                <strong class="block text-base-content/40">Custom Tiers (Planned)</strong>
                                <span class="text-xs text-base-content/40">e.g., Gold, Platinum, Enterprise.</span>
                            </div>
                        </li>
                        <li class="step step-secondary" data-content="üõ°Ô∏è">
                            <div class="text-left w-full pl-4">
                                <strong class="block">Admin</strong>
                                <span class="text-xs text-base-content/60">Client Application Administrator.</span>
                            </div>
                        </li>
                        <li class="step step-secondary" data-content="‚ö°">
                            <div class="text-left w-full pl-4">
                                <strong class="block">Super Admin</strong>
                                <span class="text-xs text-base-content/60">Client Application Owner.</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="bg-base-200 p-6 rounded-xl border border-base-300 h-fit">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="badge badge-warning">System Level</span>
                        <h3 class="font-bold">God Admin (Bifrost Admin)</h3>
                    </div>
                    <p class="text-sm mb-4">
                        This role exists outside the client application scope. God Admins have cross-application access for debugging, billing management, and system configuration.
                    </p>
                    <div class="alert bg-base-100 shadow-sm text-xs">
                        This role cannot be assigned via API. It is strictly for Bifrost maintainers.
                    </div>
                </div>
            </div>
        </section>

        <section id="auth-hosted" class="mb-24 scroll-mt-24">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="bg-primary text-primary-content w-8 h-8 rounded-lg flex items-center justify-center text-sm">1</span>
                Hosted Login UI
            </h2>

            <div class="overflow-x-auto bg-base-100 border border-base-200 rounded-xl shadow-sm">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr class="bg-base-200 text-base-content">
                            <th class="w-1/4">View Name</th>
                            <th class="w-1/3">Endpoint URL (Click to Copy)</th>
                            <th>Description & Parameters</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-bold">Sign In</td>
                            <td><code onclick="copyText('/auth/ui/login')" class="endpoint-copy text-xs bg-base-300 p-2 rounded block">/auth/ui/login</code></td>
                            <td class="text-sm">
                                Standard Login.<br>
                                <span class="badge badge-xs badge-outline mt-1">Param</span> <code>client_id</code>
                            </td>
                        </tr>
                        <tr>
                            <td class="font-bold">Forgot Password</td>
                            <td><code onclick="copyText('/auth/ui/forgot-password')" class="endpoint-copy text-xs bg-base-300 p-2 rounded block">/auth/ui/forgot-password</code></td>
                            <td class="text-sm">
                                Self-service recovery.<br>
                                <span class="badge badge-xs badge-outline mt-1">Param</span> <code>client_id</code>
                            </td>
                        </tr>
                        <tr>
                            <td class="font-bold">Activate Account</td>
                            <td><code onclick="copyText('/auth/ui/set-password')" class="endpoint-copy text-xs bg-base-300 p-2 rounded block">/auth/ui/set-password</code></td>
                            <td class="text-sm">
                                Invite Flow.<br>
                                <span class="badge badge-xs badge-outline mt-1">Param</span> <code>verification_id</code>, <code>client_id</code>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="auth-api" class="mb-24 scroll-mt-24">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="bg-primary text-primary-content w-8 h-8 rounded-lg flex items-center justify-center text-sm">2</span>
                Client API (Authentication)
            </h2>
            <p class="mb-6 text-base-content/80">Public endpoints for custom frontends. No Basic Auth required.</p>

            <div class="space-y-4">
                <div class="collapse collapse-arrow border border-base-200 bg-base-100">
                    <input type="checkbox" />
                    <div class="collapse-title text-lg font-medium flex gap-3 items-center">
                        <span class="badge badge-success text-xs">POST</span>
                        <code onclick="copyText('/auth/api/check-email')" class="endpoint-copy hover:bg-base-200 px-2 rounded">/auth/api/check-email</code>
                    </div>
                    <div class="collapse-content">
                        <div class="payload-block pl-4 mt-2">
                            <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Payload</div>
                            <pre><code class="language-json">{ "email": "user@example.com" }</code></pre>
                        </div>
                    </div>
                </div>

                <div class="collapse collapse-arrow border border-base-200 bg-base-100">
                    <input type="checkbox" checked />
                    <div class="collapse-title text-lg font-medium flex gap-3 items-center">
                        <span class="badge badge-success text-xs">POST</span>
                        <code onclick="copyText('/auth/api/login')" class="endpoint-copy hover:bg-base-200 px-2 rounded">/auth/api/login</code>
                    </div>
                    <div class="collapse-content">
                         <div class="payload-block pl-4 mt-2">
                            <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Payload</div>
                            <pre><code class="language-json">{
    "client_id": "YOUR_CLIENT_ID",
    "identifier": "user@example.com",
    "password": "secret_password"
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="collapse collapse-arrow border border-base-200 bg-base-100">
                    <input type="checkbox" />
                    <div class="collapse-title text-lg font-medium flex gap-3 items-center">
                        <span class="badge badge-success text-xs">POST</span>
                        <code onclick="copyText('/auth/api/verify-otp-login')" class="endpoint-copy hover:bg-base-200 px-2 rounded">/auth/api/verify-otp-login</code>
                    </div>
                    <div class="collapse-content">
                         <div class="payload-block pl-4 mt-2">
                            <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Payload</div>
                            <pre><code class="language-json">{
    "client_id": "YOUR_CLIENT_ID",
    "code": "123456"
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="internal-api" class="mb-24 scroll-mt-24">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="bg-primary text-primary-content w-8 h-8 rounded-lg flex items-center justify-center text-sm">3</span>
                Internal API (Server-to-Server)
            </h2>
            <div class="alert alert-warning shadow-sm mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                <div class="text-xs">
                    <strong>Auth Required:</strong> <code>Username = Client ID</code>, <code>Password = Client Secret</code>.
                </div>
            </div>

            <div class="overflow-x-auto bg-base-100 border border-base-200 rounded-xl">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th>Endpoint (Click to Copy)</th>
                            <th>Method</th>
                            <th>Payload Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code onclick="copyText('/internal/validate-token')" class="endpoint-copy text-xs bg-base-300 p-2 rounded">/internal/validate-token</code></td>
                            <td><span class="badge badge-success badge-xs">POST</span></td>
                            <td><code class="text-xs">{ "jwt": "..." }</code></td>
                        </tr>
                        <tr>
                            <td><code onclick="copyText('/internal/generate-link-token')" class="endpoint-copy text-xs bg-base-300 p-2 rounded">/internal/generate-link-token</code></td>
                            <td><span class="badge badge-success badge-xs">POST</span></td>
                            <td><code class="text-xs">{ "account_id": "..." }</code></td>
                        </tr>
                        <tr>
                            <td><code onclick="copyText('/internal/link-account')" class="endpoint-copy text-xs bg-base-300 p-2 rounded">/internal/link-account</code></td>
                            <td><span class="badge badge-success badge-xs">POST</span></td>
                            <td><code class="text-xs">{ "link_token": "...", "telegram_id": "..." }</code></td>
                        </tr>
                        <tr>
                            <td><code onclick="copyText('/internal/generate-otp')" class="endpoint-copy text-xs bg-base-300 p-2 rounded">/internal/generate-otp</code></td>
                            <td><span class="badge badge-success badge-xs">POST</span></td>
                            <td><code class="text-xs">{ "telegram_id": "123456" }</code></td>
                        </tr>
                        <tr>
                            <td><code onclick="copyText('/internal/get-role')" class="endpoint-copy text-xs bg-base-300 p-2 rounded">/internal/get-role</code></td>
                            <td><span class="badge badge-success badge-xs">POST</span></td>
                            <td><code class="text-xs">{ "telegram_id": "123456" }</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="payments-api" class="mb-24 scroll-mt-24">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="bg-primary text-primary-content w-8 h-8 rounded-lg flex items-center justify-center text-sm">4</span>
                Payments API
            </h2>

            <div class="space-y-8">

                <div class="card bg-base-100 border border-base-200">
                    <div class="card-body p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="card-title text-base">Secure Payment Intent</h3>
                            <div class="badge badge-success">POST</div>
                        </div>
                        <code onclick="copyText('/internal/payments/secure-intent')" class="endpoint-copy text-sm bg-base-200 p-2 rounded block mb-2 mt-2">/internal/payments/secure-intent</code>

                        <div class="payload-block pl-4 mt-2">
                             <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Payload</div>
                             <pre><code class="language-json">{
    "amount": 9.99,
    "currency": "USD",
    "target_role": "premium_user",
    "duration": "1m", // 1m, 3m, 6m, 1y, lifetime
    "client_ref_id": "INV-1001"
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="card bg-base-100 border border-base-200">
                    <div class="card-body p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="card-title text-base">Universal Claim</h3>
                            <div class="badge badge-success">POST</div>
                        </div>
                        <p class="text-sm text-base-content/70">Manually claim a transaction (found via bank logs, etc.) for a specific user.</p>
                        <code onclick="copyText('/internal/payments/claim')" class="endpoint-copy text-sm bg-base-200 p-2 rounded block mb-2 mt-2">/internal/payments/claim</code>

                        <div class="payload-block pl-4 mt-2">
                            <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Payload</div>
                            <pre><code class="language-json">{
    "trx_input": "ABA_123456789", // The raw transaction ID to find
    "target_app_id": "your_client_id_here",
    "identity_type": "telegram_id", // Options: 'telegram_id', 'account_id', 'email'
    "identity_value": "9988776655"
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="card bg-base-100 border border-base-200">
                    <div class="card-body p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="card-title text-base">Admin Grant (Manual Upgrade)</h3>
                            <div class="badge badge-success">POST</div>
                        </div>
                        <p class="text-sm text-base-content/70">Forcefully upgrade a user's role without payment.</p>
                        <code onclick="copyText('/internal/grant-premium')" class="endpoint-copy text-sm bg-base-200 p-2 rounded block mb-2 mt-2">/internal/grant-premium</code>

                        <div class="payload-block pl-4 mt-2">
                            <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Payload</div>
                            <pre><code class="language-json">{
    "telegram_id": "123456789",
    "target_client_id": "optional_if_cross_app",
    "duration": "1m" // optional, defaults to infinite if missing
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="card bg-base-100 border border-base-200">
                    <div class="card-body p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="card-title text-base">Submit Proof (Web Upload)</h3>
                            <div class="badge badge-success">POST</div>
                        </div>
                        <code onclick="copyText('/internal/payments/submit-proof')" class="endpoint-copy text-sm bg-base-200 p-2 rounded block mb-2 mt-2">/internal/payments/submit-proof</code>
                        <div class="text-xs font-bold uppercase tracking-wide text-base-content/50 mb-1">Multipart Form Data</div>
                        <div class="mockup-code bg-[#282c34] text-xs">
                            <pre data-prefix=">"><code>file: (binary_image_data)</code></pre>
                            <pre data-prefix=">"><code>account_id: "65a..."</code></pre>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="webhooks" class="mb-24 scroll-mt-24">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="bg-primary text-primary-content w-8 h-8 rounded-lg flex items-center justify-center text-sm">5</span>
                Webhooks
            </h2>
            <div class="mockup-code bg-[#282c34] text-white mb-8">
                <pre><code>Header: X-Bifrost-Signature</code></pre>
                <pre><code>Value: HMAC-SHA256(Client_Secret, Request_Body)</code></pre>
            </div>

            <div class="collapse collapse-plus bg-base-100 border border-base-200">
                <input type="radio" name="webhook-accordion" checked="checked" />
                <div class="collapse-title text-md font-bold text-indigo-600">subscription_success</div>
                <div class="collapse-content">
                    <pre><code class="language-json">{
  "event": "subscription_success",
  "account_id": "65a...",
  "amount": 9.99,
  "role": "premium_user"
}</code></pre>
                </div>
            </div>

            <div class="collapse collapse-plus bg-base-100 border border-base-200 mt-2">
                <input type="radio" name="webhook-accordion" />
                <div class="collapse-title text-md font-bold text-rose-600">subscription_expired</div>
                <div class="collapse-content">
                    <pre><code class="language-json">{
  "event": "subscription_expired",
  "account_id": "65a...",
  "new_role": "user"
}</code></pre>
                </div>
            </div>
        </section>

    </main>
  </div>

  <div class="drawer-side z-40">
    <label for="docs-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
    <aside class="bg-base-200 w-80 min-h-full flex flex-col border-r border-base-300">

        <div class="p-6 border-b border-base-300">
            <div class="flex items-center gap-3">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Bifrost" class="h-8 w-auto">
                <span class="font-bold text-xl tracking-tight">Bifrost API</span>
            </div>
            <div class="badge badge-success badge-outline mt-3 font-bold gap-2 w-full py-3">
                <div class="w-2 h-2 rounded-full bg-success animate-pulse"></div>
                System Operational
            </div>
        </div>

        <ul class="menu p-4 w-full text-base-content font-medium gap-1">
            <li class="menu-title opacity-50 uppercase tracking-widest text-xs mt-2">Getting Started</li>
            <li><a href="#roles-hierarchy" class="nav-link">Role Hierarchy</a></li>
            <li><a href="#auth-hosted" class="nav-link">Hosted UI</a></li>

            <li class="menu-title opacity-50 uppercase tracking-widest text-xs mt-6">Authentication</li>
            <li><a href="#auth-api" class="nav-link">Client API</a></li>

            <li class="menu-title opacity-50 uppercase tracking-widest text-xs mt-6">Backend Integration</li>
            <li><a href="#internal-api" class="nav-link">Internal API (S2S)</a></li>
            <li><a href="#payments-api" class="nav-link">Payments</a></li>
            <li><a href="#webhooks" class="nav-link">Webhooks</a></li>

            <li class="mt-8">
                <a href="{{ url_for('changelog_page') }}" class="btn btn-warning btn-sm text-warning-content no-animation justify-start">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-4 h-4 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
                    System Changelog
                </a>
            </li>
        </ul>

        <div class="mt-auto p-4 border-t border-base-300">
            <a href="/backoffice" class="btn btn-neutral w-full">‚Üê Back to Portal</a>
        </div>
    </aside>
  </div>
</div>

<script>
    function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
            const toast = document.createElement('div');
            toast.className = 'alert alert-success text-white text-xs py-2 px-4 shadow-lg rounded-xl';
            toast.innerText = 'Copied to clipboard!';

            const container = document.getElementById('toast-container');
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 2000);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');

        // Scroll Spy
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => link.classList.remove('active'));
                    const id = entry.target.getAttribute('id');
                    const activeLink = document.querySelector(`.nav-link[href="#${id}"]`);
                    if (activeLink) activeLink.classList.add('active');
                }
            });
        }, { rootMargin: '-20% 0px -60% 0px' });

        sections.forEach(section => observer.observe(section));
    });
</script>
</body>
</html>